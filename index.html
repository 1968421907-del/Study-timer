<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Study & Break Timer</title>
  <style>
    * { box-sizing: border-box; font-family: system-ui, sans-serif; }
    body { margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; transition: background-color .6s ease; }
    .app { background:rgba(255,255,255,.9); padding:22px 26px 26px; border-radius:18px; width:100%; max-width:420px; text-align:center; box-shadow:0 20px 40px rgba(0,0,0,.18); }
    h1 { margin:0 0 6px; }
    .phase { font-weight:600; margin-bottom:10px; }
    .timer { font-size:3rem; font-weight:800; margin:8px 0 16px; }
    .section { margin-bottom:16px; }
    .buttons { display:grid; grid-template-columns:repeat(auto-fit,minmax(64px,1fr)); gap:8px; }
    button { padding:10px; border:none; border-radius:10px; background:#222; color:#fff; font-weight:700; cursor:pointer; }
    button.secondary { background:#666; }
    button.danger { background:#b00020; }
    .controls { display:flex; gap:10px; justify-content:center; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="app">
    <h1>Study Timer</h1>
    <div class="phase" id="phase">Choose a study time</div>
    <div class="timer" id="timer">00:00</div>

    <div class="section" id="studySection">
      <div class="buttons" id="studyButtons"></div>
    </div>

    <div class="section hidden" id="breakSection">
      <div class="buttons" id="breakButtons"></div>
    </div>

    <div class="controls">
      <button class="secondary" id="pauseBtn">Pause</button>
      <button class="secondary hidden" id="muteBtn">Mute</button>
      <button class="danger" id="resetBtn">Reset</button>
    </div>
  </div>

  <!-- YouTube API -->
  <div id="studyPlayer" style="display:none"></div>
  <div id="breakPlayer" style="display:none"></div>
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    const studyTimes = [5,10,15,20,25,30,45];
    const breakTimes = [2,3,5,8,10,15];
    const colors = ['#ff9ecf','#b57cff','#7ed957','#6ecbff'];

    let intervalId = null;
    let remainingSeconds = 0;
    let currentStudyMinutes = null;
    let phase = 'idle';
    let colorIndex = 0;
    let isMuted = false;

    const timerEl = document.getElementById('timer');
    const phaseEl = document.getElementById('phase');
    const studySection = document.getElementById('studySection');
    const breakSection = document.getElementById('breakSection');
    const studyButtonsEl = document.getElementById('studyButtons');
    const breakButtonsEl = document.getElementById('breakButtons');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const muteBtn = document.getElementById('muteBtn');

    let studyPlayer, breakPlayer;

    function format(sec){ const m=Math.floor(sec/60), s=sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
    function nextBg(){ document.body.style.backgroundColor = colors[colorIndex]; colorIndex=(colorIndex+1)%colors.length; }

    function startTimer(seconds,newPhase){
      clearInterval(intervalId);
      remainingSeconds = seconds;
      phase = newPhase;
      timerEl.textContent = format(remainingSeconds);

      if(phase==='study'){
            studyPlayer?.pauseVideo();
            breakSection.classList.remove('hidden');
            phaseEl.textContent='Choose a break time';
          } else {
            // BREAK JUST ENDED â†’ play alert once
            if(breakPlayer){ breakPlayer.playVideo(); }
            setTimeout(()=>{
              breakPlayer?.pauseVideo();
              startTimer(currentStudyMinutes*60,'study');
            },1500);
          }
        }
      },1000);
    }

    // Build STUDY buttons FIRST (this starts the flow)
    studyTimes.forEach(min=>{
      const b=document.createElement('button');
      b.textContent=`${min} min`;
      b.onclick=()=>{
        currentStudyMinutes=min;
        studySection.classList.add('hidden');
        breakSection.classList.add('hidden');
        startTimer(min*60,'study');
      };
      };
      studyButtonsEl.appendChild(b);
    });

    breakTimes.forEach(min=>{
      const b=document.createElement('button');
      b.textContent=`${min} min`;
      b.onclick=()=>{
        breakSection.classList.add('hidden');
        startTimer(min*60,'break');
      };
      breakButtonsEl.appendChild(b);
    });

    pauseBtn.onclick=()=>{
      if(phase==='idle') return;
      if(intervalId){ clearInterval(intervalId); intervalId=null; pauseBtn.textContent='Resume'; studyPlayer?.pauseVideo(); breakPlayer?.pauseVideo(); }
      else { pauseBtn.textContent='Pause'; startTimer(remainingSeconds,phase); }
    };

    resetBtn.onclick=()=>{
      clearInterval(intervalId); intervalId=null; phase='idle'; currentStudyMinutes=null;
      studySection.classList.remove('hidden'); breakSection.classList.add('hidden');
      phaseEl.textContent='Choose a study time'; timerEl.textContent='00:00';
      document.body.style.backgroundColor='#fff'; pauseBtn.textContent='Pause'; muteBtn.classList.add('hidden');
      studyPlayer?.pauseVideo(); breakPlayer?.pauseVideo();
    };

    muteBtn.onclick=()=>{ isMuted=!isMuted; muteBtn.textContent=isMuted?'Unmute':'Mute'; if(studyPlayer){ isMuted?studyPlayer.mute():studyPlayer.unMute(); } };

    function onYouTubeIframeAPIReady(){
      studyPlayer = new YT.Player('studyPlayer',{ videoId:'6d8CbHqXD9Y', playerVars:{ autoplay:0, loop:1, playlist:'6d8CbHqXD9Y' }});
      breakPlayer = new YT.Player('breakPlayer',{ videoId:'LH0xb6g0o_k', playerVars:{ autoplay:0 } });
    }
  </script>
</body>
</html>
